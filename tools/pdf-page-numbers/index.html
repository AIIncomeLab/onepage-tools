<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>PDF 添加页码</title>
<meta name="description" content="批量为 PDF 文档添加自定义格式的页码。">
<link rel="stylesheet" href="/assets/styles.css">
<script src="/assets/layout.js" defer></script>
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
</head>
<body>
<header class="container site-header" data-site-header data-title="PDF 添加页码"></header>
<main class="container card">
<label>选择 PDF：</label>
<input class="input" type="file" id="file" accept="application/pdf">
<label>页码格式：</label>
<input class="input" type="text" id="format" value="第 {n} 页 / 共 {total} 页">
<label>位置：</label>
<select class="input" id="position">
<option value="bottom-center">底部居中</option>
<option value="bottom-right">底部右侧</option>
<option value="bottom-left">底部左侧</option>
<option value="top-right">顶部右侧</option>
</select>
<label>字体大小：</label>
<input class="input" type="number" id="size" value="12" min="6" max="32">
<button class="btn" id="run">添加页码</button>
<div id="msg" class="muted" style="margin-top:12px"></div>
</main>
<footer class="container site-footer" data-site-footer></footer>
<script>
const $=s=>document.querySelector(s);
$('#run').onclick=async()=>{
  const file=$('#file').files[0];
  if(!file) return alert('请选择 PDF');
  $('#msg').textContent='处理中…';
  const bytes=new Uint8Array(await file.arrayBuffer());
  const pdf=await PDFLib.PDFDocument.load(bytes);
  const font=await pdf.embedFont(PDFLib.StandardFonts.Helvetica);
  const total=pdf.getPageCount();
  const size=parseFloat($('#size').value)||12;
  const pos=$('#position').value;
  pdf.getPages().forEach((page,idx)=>{
    const n=idx+1;
    const text=$('#format').value.replace('{n}',n).replace('{total}',total);
    const width=page.getWidth();
    const height=page.getHeight();
    const textWidth=font.widthOfTextAtSize(text,size);
    let x=width/2-textWidth/2;
    let y=30;
    if(pos==='bottom-right'){x=width-40-textWidth;y=30;}
    if(pos==='bottom-left'){x=40;y=30;}
    if(pos==='top-right'){x=width-40-textWidth;y=height-40;}
    page.drawText(text,{x,y,font,size,color:PDFLib.rgb(0.3,0.3,0.3)});
  });
  const out=await pdf.save();
  const blob=new Blob([out],{type:'application/pdf'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download=`page-number-${file.name}`;
  a.click();
  $('#msg').textContent='完成！';
};
</script>
</body>
</html>
