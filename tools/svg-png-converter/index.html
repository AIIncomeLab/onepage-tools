<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>SVG ↔ PNG 互转</title>
<meta name="description" content="在浏览器内将 SVG 矢量图转换为 PNG，或将 PNG 嵌入 SVG 容器。">
<link rel="stylesheet" href="/assets/styles.css">
<script src="/assets/layout.js" defer></script>
</head>
<body>
<header class="container site-header" data-site-header data-title="SVG ↔ PNG 互转"></header>
<main class="container card">
<section style="margin-bottom:24px">
<h2>SVG 转 PNG</h2>
<label>选择 SVG 文件：</label>
<input class="input" type="file" id="svgFile" accept="image/svg+xml">
<label>导出尺寸（像素）：</label>
<div class="grid cols-2">
<input class="input" type="number" id="pngWidth" placeholder="宽度 (可选)">
<input class="input" type="number" id="pngHeight" placeholder="高度 (可选)">
</div>
<button class="btn" id="svgToPng">转换为 PNG</button>
<div id="svgResult" style="margin-top:12px"></div>
</section>
<hr>
<section>
<h2>PNG/JPG 转 SVG（嵌入位图）</h2>
<label>选择图片：</label>
<input class="input" type="file" id="pngFile" accept="image/png,image/jpeg">
<button class="btn" id="pngToSvg">生成 SVG</button>
<div id="pngResult" style="margin-top:12px"></div>
</section>
</main>
<footer class="container site-footer" data-site-footer></footer>
<script>
const $=s=>document.querySelector(s);
$('#svgToPng').onclick=async()=>{
  const file=$('#svgFile').files[0];
  if(!file) return alert('请选择 SVG 文件');
  const text=await file.text();
  const svgBlob=new Blob([text],{type:'image/svg+xml'});
  const url=URL.createObjectURL(svgBlob);
  const img=new Image();
  img.src=url;
  await img.decode();
  const width=parseInt($('#pngWidth').value,10)||img.width||512;
  const height=parseInt($('#pngHeight').value,10)||img.height||width;
  const canvas=document.createElement('canvas');
  canvas.width=width;
  canvas.height=height;
  const ctx=canvas.getContext('2d');
  ctx.drawImage(img,0,0,width,height);
  const pngUrl=canvas.toDataURL('image/png');
  $('#svgResult').innerHTML=`<img src="${pngUrl}" style="max-width:100%;border-radius:12px;background:#fff"><br>
  <a class="btn" href="${pngUrl}" download="${file.name.replace(/\.svg$/i,'')||'image'}.png">下载 PNG</a>`;
};
$('#pngToSvg').onclick=async()=>{
  const file=$('#pngFile').files[0];
  if(!file) return alert('请选择 PNG/JPG 图片');
  const base64=await new Promise(res=>{
    const reader=new FileReader();
    reader.onload=()=>res(reader.result.split(',')[1]);
    reader.readAsDataURL(file);
  });
  const svg=`<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" preserveAspectRatio="xMidYMid meet"><image href="data:${file.type};base64,${base64}" width="100%" height="100%"/></svg>`;
  const blob=new Blob([svg],{type:'image/svg+xml'});
  const url=URL.createObjectURL(blob);
  $('#pngResult').innerHTML=`<textarea class="input" rows="6">${svg}</textarea><br>
  <a class="btn" href="${url}" download="${file.name.replace(/\.[^.]+$/,'')}.svg">下载 SVG</a>`;
};
</script>
</body>
</html>
