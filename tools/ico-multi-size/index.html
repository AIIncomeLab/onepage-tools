<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>ICO 多尺寸合成</title>
<meta name="description" content="上传一张图片，自动生成包含 16-256 像素的 ICO 图标文件。">
<link rel="stylesheet" href="/assets/styles.css">
<script src="/assets/layout.js" defer></script>
<script src="https://unpkg.com/icojs@0.5.4/dist/ico.min.js"></script>
</head>
<body>
<header class="container site-header" data-site-header data-title="ICO 多尺寸合成"></header>
<main class="container card">
<label>选择图片（推荐方形 PNG/SVG）：</label>
<input class="input" type="file" id="file" accept="image/*">
<button class="btn" id="run">生成 ICO</button>
<div id="preview" style="margin-top:16px"></div>
</main>
<footer class="container site-footer" data-site-footer></footer>
<script>
const $=s=>document.querySelector(s);
const sizes=[16,24,32,48,64,128,256];
$('#run').onclick=async()=>{
  const file=$('#file').files[0];
  if(!file) return alert('请选择图片');
  const img=new Image();
  img.src=URL.createObjectURL(file);
  await img.decode();
  const images=[];
  sizes.forEach(size=>{
    const canvas=document.createElement('canvas');
    canvas.width=size;canvas.height=size;
    const ctx=canvas.getContext('2d');
    ctx.drawImage(img,0,0,size,size);
    images.push(canvas);
  });
  const icoArray=await ICO.encode(images.map(canvas=>({width:canvas.width,height:canvas.height,bpp:32,data:canvas})));
  const blob=new Blob([icoArray.buffer],{type:'image/x-icon'});
  const url=URL.createObjectURL(blob);
  const previewUrl=images[images.length-1].toDataURL('image/png');
  $('#preview').innerHTML=`<img src="${previewUrl}" style="width:128px;height:128px;border-radius:12px;background:#fff"><br>
  <a class="btn" href="${url}" download="icon.ico">下载 ICO</a>`;
};
</script>
</body>
</html>
